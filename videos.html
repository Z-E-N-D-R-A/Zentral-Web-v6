<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Zentral-Web | Videos</title>
    <link href="Assets/Icon.png" rel="icon">
    <link href="CSS/style.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <header>
      <div class="logo">
        <img src="Assets/Logo.png" alt="Logo">
        <span>Zendra クレイジー</span>
      </div>
      <nav class="nav-links">
        <a href="index.html">Home</a>
        <a href="Videos.html" class="active"><b>Videos</b></a>
        <a href="zentral.html">Zentral</a>
        <div class="dropdown">
          <button class="dropbtn">More ▾</button>
          <div class="dropdown-content">
            <a href="projects.html">Projects</a>
            <a href="newsletter.html">Newsletter</a>
            <a href="others.html">Others</a>
          </div>
        </div>
      </nav>
          <div class="hamburger">
      <span></span>
      <span></span>
      <span></span>
    </div>
    </header>
  
    <section class="stats-section">
      <div class="count-container">
        <div class="platform ig">
          <h3>Instagram</h3>
          <div id="igCount">0</div>
          <a href="https://www.instagram.com/zendra_brawl/" target="_blank" class="follow-btn ig-btn">Follow</a>
        </div>
        <div class="platform yt"><span>
          <h3><span>YouTube</span></h3>
          <div id="ytCount">0</div>
          <a href="https://www.youtube.com/channel/UCaWAxGQH0nU3w5PXDppmcvQ/?sub_confirmation=1" target="_blank" class="follow-btn yt-btn">Subscribe</a>
          </span>
        </div>
        <div class="platform tk">
          <h3>TikTok</h3>
          <div id="tiktokCount">0</div>
          <a href="http://www.tiktok.com/@zendra_brawl" target="_blank" class="follow-btn tk-btn">Follow</a>
        </div>
      </div>
    </section>

    <section class="suggested" id="suggestedSection"></section>
  
    <section class="videos-gallery">
      <h2 id="videos-title">Recent Videos</h2>
      <div id="videoGrid" class="video-grid"></div>
    </section>
    
    <footer>
        <div class="footer-socials">
          <a href="https://www.youtube.com/@zendra_brawl" target="_blank"><i class="fab fa-youtube yt-hover"></i></a>
          <a href="https://www.instagram.com/zendra_brawl/" target="_blank"><i class="fab fa-instagram ig-hover"></i></a>
          <a href="http://www.tiktok.com/@zendra_brawl" target="_blank"><i class="fab fa-tiktok tk-hover"></i></a>
          <a href="https://discord.gg/VbUFdhEjNq" target="_blank"><i class="fab fa-discord dc-hover"></i></a>
          <a href="https://www.twitch.tv/zendra_brawl" target="_blank"><i class="fab fa-twitch tw-hover"></i></a>
          <a href="https://twitter.com/zendra_brawl" target="_blank"><i class="fab fa-x-twitter x-hover"></i></a>
        </div>
        2026 Zentral-Web | Powered by KuraWorks
    </footer>
  
    <script>
      /* -------- Animate Count -------- */
      const YAK = "AIzaSyBCtzknAcH5qynOqexUD-szsNYcCKfR7Sk";
      const YCI = "UCaWAxGQH0nU3w5PXDppmcvQ";
      function initFollowerCounts() {
        updateYouTubeStats();
        animateCount("igCount", 1300);
        animateCount("tiktokCount", 1350);
      }

      function animateCount(id, target) {
        const el = document.getElementById(id);
        if (!el) return;

        let count = 0;
        const increment = target / 50;
        
        const timer = setInterval(() => {
          count += increment;
          el.textContent = Math.floor(count).toLocaleString();
          
          if (count >= target) {
            el.textContent = target.toLocaleString();
            clearInterval(timer);
          }
        }, 40);
      }

      async function updateYouTubeStats() {
        try {
          const res = await fetch(`https://www.googleapis.com/youtube/v3/channels?part=statistics&id=${YCI}&key=${YAK}`);
          const data = await res.json();
          if (!data.items || !data.items.length) {
            animateCount("ytCount", 1000);
            return;
          }

          const stats = data.items[0].statistics;
          animateCount("ytCount", Number(stats.subscriberCount));
        } catch (err) {
          console.log("YouTube Stats Loading Error: " + err);
        }
      }
      
      /* -------- Suggested Contents -------- */
      async function loadSuggestedData() {
        const videoId = "jDHrCU9Q0ME";
        const playlistId = "PLE9_yXA2umvKX27H9yC5u4xE8aQ0wXH4L";
        const section = document.getElementById("suggestedSection");
        section.innerHTML = "";

        const [videoRes, playlistRes] = await Promise.all([
          fetch(`https://www.googleapis.com/youtube/v3/videos?part=snippet,statistics&id=${videoId}&key=${YAK}`),
          fetch(`https://www.googleapis.com/youtube/v3/playlists?part=snippet,contentDetails&id=${playlistId}&key=${YAK}`)
        ]);

        const videoData = await videoRes.json();
        const playlistData = await playlistRes.json();

        if (!videoData.items || !videoData.items.length) return;
        if (!playlistData.items || !playlistData.items.length) return;

        if (videoData.items && videoData.items.length) {
          const v = videoData.items[0];
          const videoUrl = `https://youtu.be/${videoId}`;
          const videoHTML = `
          <div class="suggested-content">
            <h2>Suggested Video</h2>
            <div class="suggested-thumbnail" data-url="${videoUrl}">
              <img src="https://img.youtube.com/vi/${videoId}/hqdefault.jpg" alt="${v.snippet.title}">
              <div class="play-overlay"><i class="fa-solid fa-play"></i></div>
            </div>
            <div class="suggested-info">
              <h3>${v.snippet.title}</h3>
              <p>Uploaded ${timeAgo(v.snippet.publishedAt)} • Video</p>
            </div>
          </div>`;
          section.insertAdjacentHTML("beforeend", videoHTML);
        }

        if (playlistData.items && playlistData.items.length) {
          const p = playlistData.items[0];
          const playlistUrl = `https://www.youtube.com/playlist?list=${playlistId}`;
          const playlistThumb = "https://img.youtube.com/vi/rQo1wFpkcmc/hqdefault.jpg";
          const playlistHTML = `
          <div class="suggested-content">
            <h2>Suggested Playlist</h2>
            <div class="suggested-thumbnail playlist" data-url="${playlistUrl}">
              <div class="playlist-stack first"></div>
              <div class="playlist-stack second"></div>
              <img src="${playlistThumb}" alt="${p.snippet.title}">
              <div class="play-overlay"><i class="fa-solid fa-play"></i></div>
            </div>
            <div class="suggested-info">
              <h3>${p.snippet.title}</h3>
              <p>${p.contentDetails.itemCount} videos • Playlist</p>
            </div>
          </div>`;
          section.insertAdjacentHTML("beforeend", playlistHTML);
        }

        document.querySelectorAll('.suggested-thumbnail').forEach(thumb => {
          thumb.addEventListener('click', () => {
            const url = thumb.getAttribute('data-url');
            window.open(url, '_blank');
          });
        });
      }
  
      function timeAgo(dateString) {
        const seconds = Math.floor((new Date() - new Date(dateString)) / 1000);
        const intervals = { year: 31536000, month: 2592000, week: 604800, day: 86400, hour: 3600, minute: 60 };
        for (let key in intervals) {
          const val = Math.floor(seconds / intervals[key]);
          if (val >= 1) return `${val} ${key}${val > 1 ? 's' : ''} ago`;
        }
        return "Just now";
      }
  
      /* -------- Recent Videos -------- */
      let videosLoaded = false;
      const numVideos = 18;
      async function loadYouTubeVideos() {
        try {
          if (videosLoaded) return;
          videosLoaded = true;

          const res = await fetch('/.netlify/functions/get-videos');
          const data = await res.json();
          if (!data.items || !data.items.length) {
            document.getElementById("videos-title").innerHTML = "Unable to load videos. Please try again later.";
            document.getElementById("videos-title").style.fontSize = "15px";
            return;
          }

          const videoGrid = document.getElementById("videoGrid");
          videoGrid.innerHTML = "";
          
          const videoItems = data.items.filter(i => i.id.kind === "youtube#video");
          const videoIds = videoItems.map(i => i.id.videoId).join(",");

          const statsRes = await fetch(`https://www.googleapis.com/youtube/v3/videos?part=statistics&id=${videoIds}&key=${YAK}`);
          const statsData = await statsRes.json();
          const statsMap = {};
          statsData.items.forEach(v => { statsMap[v.id] = v.statistics; });

          const fragment = document.createDocumentFragment();
          
          for (const item of videoItems) {
            const videoId = item.id.videoId;
            const title = item.snippet.title;
            const thumbnail = item.snippet.thumbnails.medium.url;
            const publishedAt = item.snippet.publishedAt;
            const views = statsMap[videoId]?.viewCount || 0;

            const card = document.createElement("div");
            card.className = "video-card";
            card.style.cursor = "pointer";

            card.innerHTML = `
              <div class="video-thumb">
                <img src="${thumbnail}" alt="${title}" loading="lazy" width="320" height="180" decoding="async">
              </div>
              
              <div class="video-info">
                <h4>${title} 1</h4>
                <p>${Number(views).toLocaleString()} views • ${timeAgo(publishedAt)}</p>
              </div>`;

            card.addEventListener("click", () => {
              window.open(`https://www.youtube.com/watch?v=${videoId}`, "_blank");
            });

            fragment.appendChild(card);
          }
          
          await new Promise(r => requestAnimationFrame(r));
          videoGrid.appendChild(fragment);
        } catch (err) {
          console.log("YouTube Video Loading Error: " + err);
        }
      }

      window.addEventListener("load", () => {
        initFollowerCounts();
        loadSuggestedData();
        loadYouTubeVideos();
      });

      document.addEventListener('contextmenu', event => event.preventDefault());
      document.addEventListener('keydown', event => {
        if (event.key === 'F12' || (event.ctrlKey && event.shiftKey && event.key === 'I') || (event.ctrlKey && event.key === 'u')) {
          event.preventDefault();
        }
      });

      const headerEl = document.querySelector('header');
      window.addEventListener('scroll', () => {
        const y = window.scrollY;
        const maxOpacity = 0.45;
        const maxBlur = 12;
        const pct = Math.min(y / 300, 1);
        headerEl.style.background = `rgba(0,0,0,${(pct * maxOpacity).toFixed(3)})`;
        headerEl.style.backdropFilter = `blur(${(pct * maxBlur).toFixed(2)}px)`;

        if (y > 10) headerEl.classList.add('scrolled'); else headerEl.classList.remove('scrolled');
      });

      const dropdown = document.querySelector('.dropdown');
      const dropbtn = dropdown.querySelector('.dropbtn');
      const dropdownContent = dropdown.querySelector('.dropdown-content');
      let isDropdownOpen = false;

      dropbtn.addEventListener('click', (e) => {
        e.stopPropagation();
        isDropdownOpen = !isDropdownOpen;
        dropdown.classList.toggle('show', isDropdownOpen);
      });
      dropdown.addEventListener('mouseenter', () => {
        dropdown.classList.add('show');
        isDropdownOpen = true;
      });
      dropdown.addEventListener('mouseleave', (e) => {
        const rect = dropdownContent.getBoundingClientRect();
        const buffer = 60;
        const checkMouse = (ev) => {
          if (ev.clientX < rect.left - buffer || ev.clientX > rect.right + buffer || ev.clientY < rect.top - buffer || ev.clientY > rect.bottom + buffer) {
            dropdown.classList.remove('show');
            isDropdownOpen = false;
            window.removeEventListener('mousemove', checkMouse);
          }
        };
        window.addEventListener('mousemove', checkMouse);
      });

      window.addEventListener('scroll', () => {
        dropdown.classList.remove('show');
        isDropdownOpen = false;
      });
      document.addEventListener('click', (e) => {
        if (!dropdown.contains(e.target)) {
          dropdown.classList.remove('show');
          isDropdownOpen = false;
        }
      });

      const hamburger = document.querySelector('.hamburger');
      const navLinks = document.querySelector('.nav-links');
      hamburger.addEventListener('click', () => {
        hamburger.classList.toggle('active');
        navLinks.classList.toggle('active');
      });
    </script>
  </body>
</html>